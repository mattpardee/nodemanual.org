<!DOCTYPE html><!--[if lt IE 7]> <html class="no-js ie6 oldie" lang="en"> <![endif]-->
<!--[if IE 7]>    <html class="no-js ie7 oldie" lang="en"> <![endif]-->
<!--[if IE 8]>    <html class="no-js ie8 oldie" lang="en"> <![endif]-->
<!--[if gt IE 8]><!--> <html class="no-js" lang="en"> <!--<![endif]-->
<head><meta charset="utf-8"><meta http-equiv="X-UA-Compatible" content="IE=edge,chrome=1"><title>Node.js Manual | Using Buffers</title><meta name="generator" content="c9-doc-build"><meta name="description" content="A collection of Node.js tutorials"><meta name="author" content="Garen J. Torikian"><meta name="viewport" content="width=device-width,initial-scale=1"><!-- CSS--><link rel="stylesheet" href="../resources/csses/bootstrap.css"><link rel="stylesheet" href="../resources/csses/prettify.css"><link rel="stylesheet" href="../resources/csses/refguide_overrides.css"><link rel="stylesheet" href="../resources/csses/devguide_overrides.css"><!-- end CSS--><script src="../resources/javascripts/jquery.js"></script><script src="../resources/javascripts/clicker.js"></script><script src="../resources/javascripts/jquery.collapse.js"></script><script src="../resources/javascripts/jquery.cookie.js"></script><script src="../resources/javascripts/bootstrap-dropdown.js"></script></head><body onload="styleCode()"><div class="topbar"><div class="fill"><div id="topSection" class="container"><ul class="nav"><li data-dropdown="dropdown" class="dropdown"><a href="/" class="dropdown-toggle brand"><!--div(class="arrow-down")--></a><ul class="dropdown-menu"><li><a href="http://www.nodebits.org/">Nodebits</a></li></ul></li></ul><ul class="nav"><li id="node_js_ref"><a href="../nodejs_ref_guide/index.html">Node.js Reference</a></li><li id="nodejs_dev_guide"><a href="../nodejs_dev_guide/index.html">Node.js Manual</a></li><li id="js_doc"><a href="../js_doc/index.html">Javascript Reference</a></li></ul><form id="searchbox" action="" class="pull-right"><input name="query" type="text" placeholder="Search Documentation" title="Search across all the documentation types" class="span3"></form></div></div></div><header id="overview" class="jumbotron masthead"><div class="inner"><div class="container"><h1>Node.js Manual</h1><p class="lead"></p></div></div></header><div class="container"><div class="content"><div class="row container"><div class="span5 offset4 sidebarContainer"><div id="sidebar"><div id="well"><h2>Node.js Manual</h2><h3>Basic Overview</h3><ul class="menu"><li><div class="menu-item"><a href="how-to-write-asynchronous-code.html" class="menuLink">Writing Asynchronous Code                                                        </a></div></li><li><div class="menu-item"><a href="what-are-callbacks.html" class="menuLink">Working with Callbacks</a></div></li><li><div class="menu-item"><a href="what-are-event-emitters.html" class="menuLink">Understanding Event Emitters</a></div></li><li><div class="menu-item"><a href="npm.html" class="menuLink">The Node Package Manager</a></div><ul class="menuTwo"><li><div class="menu-item"><a href="how-to-access-module-package-info.html" class="menuLink class">Accessing Module Package Info</a></div></li><li><div class="menu-item"><a href="what-is-node-core-verus-userland.html" class="menuLink class">Core Libraries versus User-Submitted Modules  </a></div></li><li><div class="menu-item"><a href="what-is-the-file-package-json.html" class="menuLink class">Parsing the File Package JSON    </a></div></li></ul></li><li><div class="menu-item"><a href="what-is-require.html" class="menuLink">Importing Modules with require()             </a></div></li><li><div class="menu-item"><a href="how-to-use-nodejs-repl.html" class="menuLink">Executing Command Line Node.js via REPL     </a></div></li></ul><h3>Tutorials</h3><ul class="menu"><li><div class="menu-item"><a href="how-to-log.html" class="menuLink">Implementing Logging Messages</a></div></li><li><div class="menu-item"><span class="menuHeader">The File System</span></div><ul class="menuTwo"><li><div class="menu-item"><a href="how-to-read-files-in-nodejs.html" class="menuLink">Reading Files            </a></div></li><li><div class="menu-item"><a href="how-to-write-files-in-nodejs.html" class="menuLink">Writing to Files   </a></div></li><li><div class="menu-item"><a href="how-to-use-the-path-module.html" class="menuLink">Manipulating Paths with the path Module</a></div></li><li><div class="menu-item"><a href="how-to-store-local-config-data.html" class="menuLink">Storing Local Configuration Data       </a></div></li><li><div class="menu-item"><a href="how-to-search-files-and-directories-in-nodejs.html" class="menuLink">Searching for Files               </a></div></li></ul></li><li><div class="menu-item"><a href="what-are-the-built-in-timer-functions.html" class="menuLink">Using Timer Functions Correctly</a></div></li><li><div class="menu-item"><span class="menuHeader">The Command Line</span></div><ul class="menuTwo"><li><div class="menu-item"><a href="how-to-prompt-for-command-line-input.html" class="menuLink">Prompting for Command Line Input             </a></div></li><li><div class="menu-item"><a href="how-to-parse-command-line-arguments.html" class="menuLink">Parsing Command Line Arguments  </a></div></li><li><div class="menu-item"><a href="how-to-get-colors-on-the-command-line.html" class="menuLink">Colors on the Command Line    </a></div></li></ul></li><li><div class="menu-item"><a href="security.html" class="menuLink">Securing Your Code  </a></div></li><li><div class="menu-item"><span class="menuHeader">HTTP Servers and Clients</span></div><ul class="menuTwo"><li><div class="menu-item"><a href="HTTP-servers.html" class="menuLink">Creating an HTTP Server</a></div></li><li><div class="menu-item"><a href="how-to-create-a-HTTPS-server.html" class="menuLink">Creating an HTTPS Server</a></div></li><li><div class="menu-item"><a href="how-to-serve-static-files.html" class="menuLink">Serving Static Files   </a></div></li><li><div class="menu-item"><a href="how-to-create-a-HTTP-request.html" class="menuLink">Creating HTTP GET and POST Requests                                 </a></div></li><li><div class="menu-item"><a href="how-to-read-POST-data.html" class="menuLink">Reading POST Data</a></div></li><li><div class="menu-item"><a href="how-to-handle-multipart-form-data.html" class="menuLink">Handling Multi-Part Form Data                               </a></div></li><li><div class="menu-item"><a href="how-to-access-query-string-parameters.html" class="menuLink">Accessing Query String Parameters  </a></div></li></ul></li><li><div class="menu-item"><span class="menuHeader">Debugging and Handling Errors</span></div><ul class="menuTwo"><li><div class="menu-item"><a href="how-to-debug-nodejs-applications.html" class="menuLink">Debugging Node.js Applications    </a></div></li><li><div class="menu-item"><a href="how-to-use-util-inspect.html" class="menuLink">Debugging with util.inspect() </a></div></li><li><div class="menu-item"><a href="what-is-try-catch.html" class="menuLink">Understanding try/catch                                  </a></div></li><li><div class="menu-item"><a href="what-is-the-error-object.html" class="menuLink">The Global Error Object</a></div></li><li><div class="menu-item"><a href="what-are-the-error-conventions.html" class="menuLink">Error Conventions</a></div></li></ul></li><li><div class="menu-item"><span class="menuHeader">Buffers and Streams</span></div><ul class="menuTwo"><li><div class="menu-item"><a href="how-to-use-buffers.html" class="menuLink">Manipulating Buffers   </a></div></li><li><div class="menu-item"><a href="streams.html" class="menuLink">Understanding Streams           </a></div></li><li><div class="menu-item"><a href="how-to-use-fs-create-read-stream.html" class="menuLink">Reading Streams   </a></div></li><li><div class="menu-item"><a href="how-to-use-fs-create-write-stream.html" class="menuLink">Writing to Streams</a></div></li><li><div class="menu-item"><a href="how-to-use-stream-pipe.html" class="menuLink">Piping Streams</a></div></li></ul></li><li><div class="menu-item"><a href="how-to-spawn-a-child-process.html" class="menuLink">Spawning Child Processes                  </a></div></li><li><div class="menu-item"><a href="how-to-create-a-custom-repl.html" class="menuLink">Creating a Custom REPL</a></div></li><li><div class="menu-item"><a href="cryptography.html" class="menuLink">Implementing Cryptography</a></div><ul class="menuTwo"><li><div class="menu-item"><a href="how-to-use-crypto-module.html" class="menuLink">Using the crypto Module    </a></div></li><li><div class="menu-item"><a href="how-to-use-the-tls-module.html" class="menuLink">Using the tls Module    </a></div></li></ul></li></ul><h3>Additional Reference</h3><ul class="menu"><li><div class="menu-item"><a href="globals-in-node-js.html" class="menuLink">A (Brief) List of Globals in Node.js</a></div></li><li><div class="menu-item"><a href="the-process-module.html" class="menuLink">Using the process Module    </a></div></li><li><div class="menu-item"><a href="the-console-module.html" class="menuLink">Using the console Module    </a></div></li><li><div class="menu-item"><span class="menuHeader">Javascript Conventions</span></div><ul class="menuTwo"><li><div class="menu-item"><a href="how-to-create-default-parameters-for-functions.html" class="menuLink">Creating Default Parameters for Functions</a></div></li><li><div class="menu-item"><a href="what-is-the-arguments-object.html" class="menuLink">The Arguments Object  </a></div></li><li><div class="menu-item"><a href="what-is-json.html" class="menuLink">About JSON </a></div></li><li><div class="menu-item"><a href="what-are-truthy-and-falsy-values.html" class="menuLink">Defining "Truthy" and "Falsy" values</a></div></li><li><div class="menu-item"><a href="using-ECMA5-in-nodejs.html" class="menuLink">Using ECMA5 in Node.js           </a></div></li></ul></li></ul></div></div></div><div class="span11"><span class="editInC9"><a href="#" title="Edit in Cloud9 IDE">[edit]</a></span><div id="content" class="dev_guide"><div class='title'>

<h1 class='pageTitle'>Understanding Buffers</h1>
<span class="cite">by Joshua Holbrook</span>

</div>



<p>Pure Javascript, while great with unicode-encoded strings, does not handle straight binary data very well. This is fine on the browser, where most data is in the form of strings. However, Node.js servers have to also deal with TCP streams and reading and writing to the filesystem, both of which make it necessary to deal with purely binary streams of data.

</p>
<p>One way to handle this problem is to just use strings <em>anyway</em>, which is exactly what Node.js did at first. However, this approach is extremely problematic to work with: it&apos;s slow, makes you work with an API designed for strings and not binary data, and has a tendency to break in strange and mysterious ways.

</p>
<p>Don&apos;t use binary strings; use buffers instead!

</p>
<div class='alert-message block-message warning'>For more detailed information, see <a href="../nodejs_ref_guide/buffer.html">the Node.js reference documentation on buffers</a>.</div>


<h4>Using Buffers</h4>
<p>Buffers are instances of the <code>Buffer</code> class in Node.js, which is designed to handle raw binary data. Each buffer corresponds to some raw memory allocated outside the V8 engine. Buffers act somewhat like arrays of integers, but aren&apos;t resizable and have a whole bunch of methods specifically for binary data. In addition, the &quot;integers&quot; in a buffer each represent a byte, and so are limited to values from 0 to 255 (2^8 - 1), inclusive.

</p>
<p>Buffers are usually seen in the context of binary data coming from streams, such as <code>fs.createReadStream()</code>.

</p>
<h4>Creating Buffers:</h4>
<p>There are a few ways to create new buffers. For example, this buffer is uninitialized and contains 8 bytes:

</p>
<pre><code>var buffer = new Buffer(8);</code></pre>
<p>This next example is a also an 8-byte bugger, loaded with some content:

</p>
<pre><code>var buffer = new Buffer([ 8, 6, 7, 5, 3, 0, 9]);</code></pre>
<p>Keep in mind that the contents of the array are integers representing bytes.

</p>
<p>To encode a buffer string, you can pass an encoding value as an optional second parameter (in this case, UTF-8):

</p>
<pre><code>var buffer = new Buffer(&quot;I&apos;m a string!&quot;, &quot;utf-8&quot;)</code></pre>
<p>UTF-8 is by far the most common encoding used with Node.js, but <code>Buffer</code> also supports:

</p>
<ul><li><code>ascii</code>: This encoding is very fast, but is limited to the ASCII character set. Moreover, it will convert <code>null</code> characters into spaces, unlike the UTF-8 encoding.</li><li><code>ucs2</code>: A two-byte, little-endian encoding. This can encode a subset of unicode.</li><li><code>base64</code>: This is for Base64 string encoding.</li><li><code>binary</code>: This is the &quot;binary string&quot; format mentioned earlier, and is in the process of being deprecated. Avoid its use. </li></ul>
<h4>Writing to Buffers</h4>
<p>After you create a buffer, you can begin writing strings to it: 

</p>
<pre><code>var buffer = new Buffer(16);
buffer.write(&quot;Hello&quot;, &quot;utf-8&quot;)</code></pre>
<p>In this case, <code>buffer.write()</code> returns 5. This means that we wrote to five bytes of the buffer. The fact that the string &quot;Hello&quot; is also five characters long is coincidental, since each character <em>just happened</em> to be 8 bits each. This is useful if you want to add to the buffer later on:

</p>
<pre><code>&gt; buffer.write(&quot; world!&quot;, 5, &quot;utf-8&quot;) // returns 7</code></pre>
<p>When <code>buffer.write</code> has three arguments, the second argument indicates an offset, or the index of the buffer to start writing at. Thus, the buffer now contains the phrase &quot;Hello world!&quot;.

</p>
<h4>Reading from Buffers</h4>
<p>The most common way to read buffers is to use the <code>toString()</code> method, since many buffers contain text:

</p>
<pre><code>&gt; buffer.toString(&apos;utf-8&apos;)
&apos;Hello world!\u0000ï¿½k\t&apos;</code></pre>
<p>The first argument indicates the encoding. In this case, due to the garbage characters are the end, it can be seen that not the entire buffer was used. Since we know how many bytes we&apos;ve written to the buffer, we can simply add more arguments to retrieve the slice that&apos;s actually interesting:

</p>
<pre><code>&gt; buffer.toString(&quot;utf-8&quot;, 0, 12) // 5 + 7 = 12
&apos;Hello world!&apos;</code></pre>
<h4>Setting Individual Octets</h4>
<p>You can also set individual bits by using an array-like syntax:

</p>
<pre><code>&gt; buffer[12] = buffer[11];
33
&gt; buffer[13] = &quot;1&quot;.charCodeAt();
49
&gt; buffer[14] = buffer[13];
49
&gt; buffer[15] = 33
33
&gt; buffer.toString(&quot;utf-8&quot;)
&apos;Hello world!!11!&apos;</code></pre>
<p>In this example, the remaining bytes are set manually, such that they represent UTF-8 encoded &quot;!&quot; (33) and &quot;1&quot; (49) characters.

</p>
<h4>Additional Buffer Methods</h4>
<ul><li><p><code>Buffer.isBuffer(object)</code>: This method checks to see if <code>object</code> is a buffer, similar to <code>Array.isArray()</code>.</p></li><li><p><code>Buffer.byteLength(string, encoding)</code>: With this function, you can check the number of bytes required to encode a string with a given encoding (which defaults to UTF-8). This length is not the same as string length, since many characters require more bytes to encode. For example:</p> </li></ul>
<script src='http://snippets.c9.io/github.com/c9/nodemanual.org-examples/nodejs_dev_guide/buffer_examples/buffer.snowman.1.js?linestart=3&lineend=0&showlines=false' defer='defer'></script>


<p>The unicode snowman is only one character, but takes 3 entire bytes to encode!

</p>
<ul><li><code>Buffer.length()</code>: This is the length of your buffer, and represents how much memory is allocated. It is not the same as the size of the buffer&apos;s contents, since a buffer may be half-filled. For example: </li></ul>
<script src='http://snippets.c9.io/github.com/c9/nodemanual.org-examples/nodejs_dev_guide/buffer_examples/buffer.snowman.2.js?linestart=3&lineend=0&showlines=false' defer='defer'></script>


<p>In this example, the contents written to the buffer only consist of three groups (since they represent the single-character snowman), but the buffer&apos;s length is still 16, as it was initialized.

</p>
<ul><li><code>Buffer.copy(target, targetStart=0, sourceStart=0, sourceEnd=buffer.length)</code>: This function allows one to copy the contents of one buffer into another. The first argument is the target buffer on which to copy the contents of <code>buffer</code>, and the rest of the arguments allow for copying only a subsection of the source buffer to somewhere in the middle of the target buffer. For example: </li></ul>
<script src='http://snippets.c9.io/github.com/c9/nodemanual.org-examples/nodejs_dev_guide/buffer_examples/buffer.snowman.3.js?linestart=3&lineend=0&showlines=false' defer='defer'></script>


<p>In this example, the <code>snowman</code> buffer, which contains a 3 byte long character, is copied to to the <code>frosty</code> buffer, which has the first 16 bytes written to it. Because the snowman character is 3 bytes long, the result takes up 19 bytes of the buffer.

</p>
<ul><li><code>Buffer.slice(start, end=buffer.length)</code>: This function is generally the same as that of <code>Array.prototype.slice()</code>, but with one very import difference: the slice is <strong>not</strong> a new buffer and merely references a subset of the memory space. In other words: <strong>modifying the slice will also modify the original buffer</strong>! For example: </li></ul>
<script src='http://snippets.c9.io/github.com/c9/nodemanual.org-examples/nodejs_dev_guide/buffer_examples/buffer.snowman.4.js?linestart=3&lineend=0&showlines=false' defer='defer'></script>


<p>Now Frosty has melted into a puddle of underscores. Bummer.</p></div><div id="disqus_thread"></div></div></div></div><footer id="footer"><div class="container"><div class="footer-text">Thanks to these content providers | &#169; 2012:</div><div class="sponsors"><a href="http://c9.io/" title="cloud9 ide" target="_blank" class="c9-logo sponsor"></a><a href="http://www.joyent.com/" title="joyent" target="_blank" class="joyent-logo sponsor"></a><a href="http://www.mozilla.org/" title="mozilla" target="_blank" class="mozilla-logo sponsor"></a><a href="http://nodejitsu.com/" title="nodejitsu" target="_blank" class="nodejitsu-logo sponsor"></a></div></div></footer></div><!-- scripts concatenated and minified via ant build script--><script defer src="../resources/javascripts/plugins.js"></script>
<script defer src="../resources/javascripts/prettify.js"></script>
<script defer src="../resources/javascripts/prettify-extension.js"></script>
<script defer src="../resources/javascripts/script.js"></script>
<script defer src="../resources/javascripts/disqus-ext.js"></script>
<!-- end scripts--><!--[if lt IE 7]><script src="//ajax.googleapis.com/ajax/libs/chrome-frame/1.0.3/CFInstall.min.js"></script><script>window.attachEvent('onload',function(){CFInstall.check({mode:'overlay'})})

</script><![endif]--></body></html>
